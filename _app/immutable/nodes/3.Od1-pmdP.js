var ie=Object.defineProperty;var ue=(i,e,t)=>e in i?ie(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var u=(i,e,t)=>ue(i,typeof e!="symbol"?e+"":e,t);import{k as M,t as j,$ as ce,l as s,r as b,m as w}from"../chunks/disclose-version.B2QKOKZv.js";import{p as K,u as O,g as U,k as C,l as T,m as L,o as r,r as pe,v as l,w as S}from"../chunks/runtime.ZUG1ED2p.js";import{d as de,e as ve}from"../chunks/render.XEYFAfoL.js";import{b as ge,p as x,s as me}from"../chunks/props.CZKQIM6c.js";import{O as $,G as z,S as fe,M as he,a as be,A as _e,W as we,g as ye,n as Q,c as F,b as qe,d as Se,e as xe,i as ze,I as k,s as Fe,f as Z,h as ke,j as Oe}from"../chunks/scope.0vxw76w_.js";import{w as Ie}from"../chunks/index.CeIcqwU0.js";console.log("Initializing Audio stack");let X=new $({frequency:300,type:"sine"});X.toDestination();let Ae=Ie(!1);X.onstop=()=>{console.log("stop"),Ae.set(!1)};const Y=.707,ee={carrierFreq:800,normalization:Y,pulseFreq:50,pulseSquish:1};function Ge(){return{...ee}}class D{constructor(e=ye()){u(this,"output");u(this,"oscillator");u(this,"pulseOscillator");u(this,"volumeGain");u(this,"pulseSquish");u(this,"_config",ee);u(this,"_volume",.5);u(this,"onState");u(this,"rampTime",5);this.context=e;const t=this.config,c=new z({context:e,gain:0}),a=new z({context:e,gain:this.volume}),o=new z({context:e,gain:t.normalization}),v=new z({context:e,gain:0}),p=new $({context:e,type:"sine",frequency:t.carrierFreq});p.chain(v,o,a,c);const _=new $({context:e,type:"sine",frequency:t.pulseFreq}),g=new fe({context:e,value:t.pulseSquish}),f=new he({context:e});g.connect(f.factor);const h=new be({context:e});g.connect(h.subtrahend);const I=new _e({context:e,value:1}),A=new we(y=>Math.max(y,0));_.chain(f,h,I,A,v.gain),this.output=c,this.volumeGain=a,this.oscillator=p,this.pulseOscillator=_,this.pulseSquish=g}start(){var t;const e=Q();this.oscillator.start(e),this.pulseOscillator.start(e),this.output.gain.linearRampTo(1,this.rampTime,e),(t=this.onState)==null||t.call(this,!0)}stop(){var t;const e=Q();this.oscillator.stop(e),this.pulseOscillator.stop(e),this.output.gain.value=0,(t=this.onState)==null||t.call(this,!1)}static sanitazieConfig(e){const t={...e};return t.normalization=Y,(t.normalization<0||t.normalization>1)&&(t.normalization=0,console.error("wrong normalization value")),t.carrierFreq=F(t.carrierFreq,50,1e3),t.pulseFreq=F(t.pulseFreq,1,150),t.pulseSquish=F(t.pulseSquish,0,5),t}set config(e){this._config=D.sanitazieConfig(e),this.oscillator.frequency.value=this._config.carrierFreq,this.pulseOscillator.frequency.value=this._config.pulseFreq,this.pulseSquish.value=this._config.pulseSquish}get config(){return{...this._config}}set volume(e){e=F(e,0,1),this._volume=e,this.volumeGain.gain.value=e}get volume(){return this._volume}}var Ne=j('<canvas class="flex overflow-hidden rounded-md" width="400" height="200"></canvas>');function Ce(i,e){K(e,!0);const t=30,c=50;let a,o;O(()=>(console.log("creating Tone.Analyzer instance"),o=new qe({type:"waveform",size:2048*2}),e.node.connect(o),()=>o.dispose())),O(()=>{const p=setInterval(()=>{Se(a,o.getValue(),c)},1e3/t);return()=>clearInterval(p)});var v=Ne();ge(v,p=>a=p,()=>a),M(i,v),U()}var Te=(i,e)=>e(),Me=j('<div><span class="text-xl font-bold text-gray-400">~</span> <!> <!> <span class="text-xl font-bold text-gray-400">^</span> <!> <!> <button class="ms-2 size-8 rounded-md bg-green-500 disabled:bg-gray-500">P</button> <button class="size-8 rounded-md bg-red-500 disabled:bg-gray-500">S</button></div>'),$e=j('<div class="flex flex-row"><div class="w-1/2"><div class="mb-4 flex flex-row items-center justify-start gap-x-8"><h1 class="text-3xl text-zinc-200">Tracks</h1> <button class="flex size-8 justify-center rounded-md bg-gray-400 px-3 py-0 text-lg font-bold hover:bg-gray-600">+</button></div> <div class="flex flex-col items-start gap-y-2"></div></div> <div><h1 class="mb-4 text-3xl text-zinc-200">Scope</h1> <!> <button class="mt-8 w-full rounded-md bg-red-500 px-2 py-1 text-center disabled:bg-gray-500">Stop All</button></div></div>');function Pe(i,e){K(e,!0);let t=T(!1),c=T(null);const a=new D;a.output.toDestination(),a.onState=n=>C(t,x(n));let o=T(x([]));function v(n){a.stop(),a.config=r(o)[n],a.volume=r(o)[n].volume,r(o)[n]=a.config,r(o)[n].volume=a.volume,C(c,x(n)),a.start()}function p(){a.stop()}function _(){const n={volume:.5,...Ge()};r(o).push(n)}O(()=>{pe(()=>{const n=localStorage.getItem("configs-base");n&&(C(o,x(JSON.parse(n))),console.log("loaded",me(r(o))))})}),O(()=>{localStorage.setItem("configs-base",JSON.stringify(r(o))),console.log("stored")}),_();var g=$e();ve("keydown",ce,n=>n.key===" "&&a.stop(),!1);var f=w(g),h=w(f),I=w(h),A=s(s(I,!0));A.__click=_,b(h);var y=s(s(h,!0));xe(y,73,()=>r(o),ze,(n,d,G)=>{var q=Me(),se=w(q),H=s(s(se,!0)),ae=S(Z);k(H,{get value(){return l(d).carrierFreq},set value(m){l(d).carrierFreq=m},className:"w-24",get format(){return r(ae)},units:"Hz",step:50});var J=s(s(H,!0)),re=S(ke);k(J,{get value(){return l(d).volume},set value(m){l(d).volume=m},className:"w-16 text-yellow-500",get format(){return r(re)},step:.01});var oe=s(s(J,!0)),P=s(s(oe,!0)),ne=S(Z);k(P,{get value(){return l(d).pulseFreq},set value(m){l(d).pulseFreq=m},className:"w-24",get format(){return r(ne)},units:"Hz",step:1});var V=s(s(P,!0)),le=S(Oe);k(V,{get value(){return l(d).pulseSquish},set value(m){l(d).pulseSquish=m},className:"w-16 text-cyan-500",get format(){return r(le)},step:.1});var N=s(s(V,!0));N.__click=()=>v(l(G));var B=s(s(N,!0));B.__click=[Te,p],b(q),L(()=>{Fe(q,`border-1 flex items-center gap-x-2 rounded-xl bg-zinc-700 p-3 ${(r(c)!==l(G)?"border border-gray-700":"border border-orange-400")??""}`),N.disabled=r(t),B.disabled=r(c)!==l(G)||!r(t)}),M(n,q)}),b(y),b(f);var R=s(s(f,!0)),te=w(R),W=s(s(te,!0));Ce(W,{get node(){return a.output}});var E=s(s(W,!0));E.__click=()=>a.stop(),b(R),b(g),L(()=>E.disabled=!r(t)),M(i,g),U()}de(["click"]);export{Pe as component};
